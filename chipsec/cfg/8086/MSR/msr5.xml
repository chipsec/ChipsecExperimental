<?xml version="1.0"?>
<configuration>
<!--
CHIPSEC: Platform Security Assessment Framework
Copyright (c) Intel Corporation

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; Version 2.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.

Contact information:
chipsec@intel.com
-->
  <!-- #################################### -->
  <!--                                      -->
  <!-- Configuration registers              -->
  <!--                                      -->
  <!-- #################################### -->
  <registers>
    <!-- CPU Model Specific Registers (MSR) -->
    <register name="IA32_MSR_CORE_THREAD_COUNT" type="msr" msr="0x35" desc="Core Thread Count">
      <field name="Thread_Count" bit="0" size="16" desc="Number of Logical Processors currently enabled"/>
      <field name="Core_Count" bit="16" size="16" desc="Number of Processor Cores currently enabled"/>
    </register>

    <register name="IA32_BIOS_SIGN_ID"    type="msr" msr="0x8B" desc="Microcode Update Signature Register">
      <field name="Microcode" bit="32" size="32" desc="Microcode update signature" />
    </register>
    <register name="IA32_SMRR_PHYSBASE"   type="msr" msr="0x1F2" desc="SMRR Base Address MSR">
      <field name="Type"     bit="0"  size="8"  desc="SMRR memory type" />
      <field name="PhysBase" bit="12" size="20" desc="SMRR physical base address" />
    </register>
    <register name="IA32_SMRR_PHYSMASK"   type="msr" msr="0x1F3" desc="SMRR Range Mask MSR">
      <field name="Valid"    bit="11" size="1"  desc="SMRR valid" />
      <field name="PhysMask" bit="12" size="20" desc="SMRR address range mask" />
    </register>
    <register name="MTRRCAP"              type="msr" msr="0xFE"  desc="MTRR Capabilities MSR">
      <field name="Fixed_Range_MTRR" bit="8" size="1" desc="Fixed range MTRRs Supported" />
      <field name="WC" bit="10" size="1" desc="WC Supported" />
      <field name="SMRR" bit="11" size="1" desc="SMRR Supported" />
      <field name="PRMRR" bit="12" size="1" desc="PRMRR Supported" />
    </register>
    <register name="IA32_FEATURE_CONTROL" type="msr" msr="0x3A"  desc="Processor Feature Control">
      <field name="LOCK"                 bit="0"  size="1"  desc="Lock" />
      <field name="EN_VMX_INSIDE_SMX"    bit="1"  size="1"  desc="Enable VMX inside SMX operation" />
      <field name="EN_VMX_OUTSIDE_SMX"   bit="2"  size="1"  desc="Enable VMX outside SMX operation" />
      <field name="Reserved0"            bit="3"  size="5"  desc="Reserved" />
      <field name="SENTER_LOCAL_EN"      bit="8"  size="7"  desc="SENTER Local Functions Enable" />
      <field name="SENTER_GLOBAL_EN"     bit="15" size="1"  desc="SENTER Global Enable" />
      <field name="Reserved1"            bit="16" size="1"  desc="Reserved" />
      <field name="SGX_LAUNCH_CTRL_EN"   bit="17" size="1"  desc="SGX Launch Control Enable" />
      <field name="SGX_GLOBAL_EN"        bit="18" size="1"  desc="SGX Global Enable" />
      <field name="Reserved2"            bit="19" size="1"  desc="Reserved" />
      <field name="LMCE_ON"              bit="20" size="1"  desc="Turn Local Machine Check On" />
    </register>
    <register name="IA32_APIC_BASE" type="msr" msr="0x1B"  desc="Local APIC Base">
      <field name="BSP"       bit="8"  size="1"  desc="Bootstrap Processor" />
      <field name="x2APICEn"  bit="10" size="1"  desc="Enable x2APIC mode" />
      <field name="En"        bit="11" size="1"  desc="APIC Global Enable" />
      <field name="APICBase"  bit="12" size="20" desc="APIC Base" />
    </register>
    <register name="MSR_SMI_COUNT" type="msr" msr="0x34" desc="SMI Count">
      <field name="Count" bit="0"  size="64" />
    </register>
    <register name="IA32_ARCH_CAPABILITIES" type="msr" msr="0x10A" desc="Architectural Capabilities MSR">
      <field name="RDCL_NO"  bit="0" size="1" desc="Processor is not susceptible to RDCL (Rogue Data Cache Load)" />
      <field name="IBRS_ALL" bit="1" size="1" desc="Processor supports enhanced Indirect Branch Restricted Speculation (IBRS)" />
    </register>
    <register name="IA32_SPEC_CTRL" type="msr" msr="0x48" desc="Speculation Control MSR">
      <field name="IBRS"  bit="0" size="1" desc="Enable Indirect Branch Restricted Speculation (IBRS)" />
      <field name="STIBP" bit="1" size="1" desc="Enable Single Thread Indirect Branch Predictors (STIBP)" />
      <field name="SSBD"  bit="2" size="1" desc="Delays speculative execution of load until the addr for all older stores are known" />
    </register>
    <register name="IA32_PRED_CMD" type="msr" msr="0x49" desc="Prediction Command MSR">
      <field name="IBPB"  bit="0" size="1" desc="IBPB Command" />
    </register>
    <register name="IA32_DEBUG_INTERFACE" type="msr" msr="0xC80" desc="Silicon Debug Feature Control">
      <field name="ENABLE"         bit="0"  size="1"  desc="Enable" />
      <field name="LOCK"           bit="30" size="1"  desc="Lock (set automatically on the first SMI)" />
      <field name="DEBUG_OCCURRED" bit="31" size="1"  desc="Debug Occurred (set by hardware)" />
    </register>

    <!-- SGX related Model Specific Registers (MSR) -->
    <!-- Check if CPUID(EAX=7,ECX=0):EBX[2] is set before accessing these registers-->

    <register name="BIOS_SE_SVN_STATUS" type="msr" msr="0x500" desc="BIOS SGX SVN status register">
      <field name="LOCK"  bit="0"  size="1" desc="ACM threshold locked" />
      <field name="SINIT_SE_SVN"  bit="16"  size="8" desc="SINIT_SE_SVN" />
    </register>
    <register name="PRMRR_VALID_CONFIG" type="msr" msr="0x1FB" desc="PRMRR VALID register">
      <field name="PRMRR_SIZE_SUPPORT"    bit="5"  size="4" desc="PRMRR size support"/>
    </register>
    <register name="SGX_DEBUG_MODE" type="msr" msr="0x503" desc="SGX debug mode resiter">
      <field name="SGX_DEBUG_MODE_STATUS_BIT"   bit="1"  size="1" desc="Debug mode status but"/>
    </register>

    <register name="MSR_SMM_FEATURE_CONTROL" type="msr" msr="0x4E0" desc="Enhanced SMM Feature Control">
      <field name="LOCK"            bit="0" size="1"  desc="Lock bit" />
      <field name="SMM_Code_Chk_En" bit="2" size="1"  desc="Prevents SMM from executing code outside the ranges defined by the SMRR" />
    </register>

    <register name="LT_LOCK_MEMORY" type="msr" msr="0x2E7" desc="LT lock memory configuration MSR">
      <field name="LT_LOCK"  bit="0" size="1" desc="Lock bit" />
    </register>

    <register name="PRMRR_PHYBASE" type="msr" msr="0x1F4" desc="PRMRR BASE Address">
      <field name="PRMRR_MEMTYPE"  bit="0"  size="3" desc="PRMRR Memory Type" />
      <field name="PRMRR_base_address_fields"   bit="12"  size="34" desc="PRMRR base address bits" />
    </register>
    <register name="PRMRR_MASK" type="msr" msr="0x1F5" desc="PRMRR MASK register">
      <field name= "PRMRR_LOCK" bit="10" size="1" desc = "PRMRR Lock Bit" />
      <field name= "PRMRR_VLD" bit="11" size="1" desc = "PRMRR Valid Bit set by mcheck" />
      <field name="PRMRR_mask_bits"   bit="12"  size="34" desc="PRMRR mask bits" />
    </register>

  </registers>

  <controls>
    <control name="Ia32FeatureControlLock" register="IA32_FEATURE_CONTROL" field="LOCK"               desc="Lock IA32 Feature Control"/>
  </controls>

</configuration>